{% extends 'customer/base.html' %}
{% load static %}

{% block header %}
<link href="{% static 'css/profile.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}


<div class="container body">

    <div class="row">
        <div class="col-md-3">
            <div class="profile-box d-flex">

                <div>
                    <img src="{% static 'images/user.png' %}" height="50px" alt="user" srcset="">
                </div>
                <div class="d-flex flex-column p-2 ">
                    <span>Hello,</span>
                    <b cla>Mohammed</b>
                </div>
            </div>


            <ul class="list-unstyled">
                <a href="" class="text-decoration-none">
                    <li>
                        <span><i class="bi bi-bag mx-2" style="font-size: 22px; "></i></span>
                        <span style="color: grey;font-weight: bold; font-size: 16px;">MY ORDERS</span>
                    </li>
                </a>

                <hr>
                <li>
                    <a href="">
                        <i class="bi bi-person mx-2" style="font-size: 22px;"></i>
                        <span style="color: grey;font-weight: bold;font-size: 16px; ">Account Settngs</span>
                    </a>
                </li>
                <div class="d-flex flex-column  mx-5 my-2">
                    <li>
                        <span style="font-size: 14px;">Profile Informations</span>
                    </li>
                    <li>
                        <span style="font-size: 14px;">Manage Address</span>
                    </li>
                    <li>
                        <span style="font-size: 14px;">Pan Card Informations</span>
                    </li>
                </div>
                <hr>
                <li>
                    <a href="">
                        <i class="bi bi-person mx-2" style="font-size: 20px;"></i>
                        <span style="color: grey;font-weight: bold;font-size: 16px; ">My Stuff</span>
                    </a>
                </li>
                <div class="d-flex flex-column  mx-5 my-2">

                    <li>
                        <span style="font-size: 14px;">reviews & Ratings</span>
                    </li>
                    <li>
                        <span style="font-size: 14px;">Pan Card Informations</span>
                    </li>
                </div>

                <hr>
                <li>
                    <a href="">
                        <svg width="24" height="24" class="mx-2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path fill="#2874F0" stroke-width="0.3" stroke="#2874F0"
                                d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z">
                            </path>
                        </svg>
                        <span style="color: grey;font-weight: bold;font-size: 16px;">Logout</span>
                    </a>
                </li>


            </ul>
        </div>

        <div class="col-md-9 ps-2 my-4">

            <div class="d-flex my-2 ">

                <div>
                    <span class="h4 mx-2 ">Personal Information</span>
                </div>
                <div>
                    <a href="" id="editName">edit</a>
                </div>

            </div>



            <div class="d-flex">


                <div class="mx-2">
                    <input type="text" value="{{ customer.first_name | title }}" readonly class="form-control  "
                        name="first_name" id="firstName">
                </div>
                <div>
                    <input type="text" value="{{ customer.last_name | title }}" readonly class="form-control "
                        name="last_name" id="lastName">

                </div>
                <div id="updateName">
                    <input type="button" class="btn btn-primary mx-2" value="Update" name="" id="btnNameUpdate">

                </div>
            </div>





            <div class="d-flex flex-column my-5">


                <div>
                    <span>Email address</span>
                    <span><a href="" id="editEmail" class="mx-2">Edit</a></span>
                </div>
                <div class="my-2 d-flex">
                    <div class="">
                        <input type="text" readonly class="form-control w-100" value="{{ customer.email }}" name=""
                            id="email">

                    </div>
                    <div id="updateEmail">
                        <input type="button" class="btn btn-primary mx-2" value="Update" name="" id="btnNameUpdate">

                    </div>
                </div>

            </div>

            <div class="d-flex flex-column my-4">


                <div>
                    <span>Mobile No</span>
                    <span><a href="" class="mx-2" id="editMobile">Edit</a></span>
                </div>
                <div class="d-flex">
                    <div>
                        <input type="text" value="{{ customer.mobile }}" readonly class="form-control w-100 my-0 "
                            name="" id="mobile">

                    </div>

                    <div id="updateMobile">
                        <input type="button" class="btn btn-primary mx-2" value="Update" name="" id="btnNameUpdate">

                    </div>



                </div>

                <div class="my-4">
                    <div id="updatePassword" class="d-flex flex-column">
                        <span><span>Password</span><a href="" class="mx-2" id="editPassword">Edit</a></span>
                        {% if not customer.is_password_changed   %}
                        <span>Last changed: <span id="passwordStatus">never</span> </span>


                        {% else %}
                         
                        <span>Last changed: <span>{{ customer.last_changed_on }}</span> </span>

                        {% endif %}

                    </div>

                    <div>


                        <div class="d-flex flex-column" id="passwordEditDiv">
                            <input type="text" class="form-control my-2" placeholder="new password" name=""
                                id="newPassword" style="width: 280px;">
                            <input type="text" class="form-control" placeholder="re type password" name=""
                                id="reTypePassword" style="width: 280px;">

                            <div class="d-flex">
                                <button type="button" class="btn my-2 mx-2" id="passwdSave"
                                    style="background-color: rgba(231, 204, 65, 0.9); width: 120px;">Save</button>
                                <button type="button" class="btn my-2 mx-2 " id="passwdCancel"
                                    style="background-color: grey;width: 120px">Cancel</button>


                            </div>
                            
                        </div>
                        <span id="spanPasswdStatus"></span>
                    </div>
                </div>
            </div>

            <div>
                <div class="h4"> FAQs</div>
                <h6>What happens when I update my email address (or mobile number)?</h6>
                <span>
                    Your login email id (or mobile number) changes, likewise. You'll receive all your account related
                    communication on your updated email address (or mobile number).
                </span>



                <h6 class="my-4">When will my eKart account be updated with the new email address (or mobile number)?
                </h6>
                <span>It happens as soon as you confirm the verification code sent to your email (or mobile) and save
                    the changes.
                </span>

                <h6 class="my-4">What happens to my existing eKart account when I update my email address (or mobile
                    number)?</h6>
                <span>
                    Updating your email address (or mobile number) doesn't invalidate your account. Your account remains
                    fully functional. You'll continue seeing your Order history, saved information and personal details.
                </span>


                <h6 class="my-4">
                    Does my Seller account get affected when I update my email address?
                </h6>
                <span>

                    eKart has a 'single sign-on' policy. Any changes will reflect in your Seller account also.
                </span>
            </div>


            <div class="mt-3">
                <a href="">Deactivate your account</a>
            </div>

        </div>
    </div>
</div>

<script>

    var currentFirstName;
    var currentLastName;
    var currentEmail;
    var currentMobile;

    $('#editName').click(function () {
        event.preventDefault()
        $('#updateName').show()
        $('#firstName').removeAttr('readonly')
        $('#lastName').removeAttr('readonly')
    })


    $('#editEmail').click(function () {
        event.preventDefault()
        $('#updateEmail').show()
        $('#email').removeAttr('readonly')

    })

    $('#editMobile').click(function () {
        event.preventDefault()
        $('#updateMobile').show()
        $('#mobile').removeAttr('readonly')

    })
    $('#editPassword').click(function () {
        event.preventDefault()

        $('#passwordEditDiv').css('visibility', 'visible');
    })

   
    $('#passwdCancel').click(function () {


        $('#passwordEditDiv').css('visibility', 'hidden');
    })

    $('#passwdSave').click(function () {

        let newPassword = $('#newPassword').val()
        let reTypePassword = $('#reTypePassword').val()

        if(newPassword.length >= 8){
            if(newPassword == reTypePassword){
                $.ajaxSetup({
                headers: {
                    "X-CSRFToken": '{{ csrf_token }}'
                }
            })   


            $.ajax({
                url: "{% url 'customer:update_customer_profile' %}",
                method: 'POST',
                data: {
                    newPassword: newPassword
                },

                success: function (response) {
                    console.log(response.status);
                     $('#passwordEditDiv').css('visibility', 'hidden');
                     $('#spanPasswdStatus').html('Password changed')
                     $('#spanPasswdStatus').css('color','green')
                     location.reload();
                }

            })

       
            }
            else{
                $('#spanPasswdStatus').html('Password does not match')
                $('#spanPasswdStatus').css('color','red')
            }
        }
        else{
                $('#spanPasswdStatus').html('Password should be min 8 characters')
                $('#spanPasswdStatus').css('color','red')

        }
    })


    document.addEventListener('DOMContentLoaded', function () {
        currentFirstName = $('#firstName').val().toLowerCase();
        currentLastName = $('#lastName').val().toLowerCase();

        currentEmail = $('#email').val();
        currentMobile = $('#mobile').val();


    })

    $('#btnNameUpdate').click(function () {

        var updatedFirstName = $('#firstName').val().toLowerCase();
        var updatedLastName = $('#lastName').val().toLowerCase();

        var params = {}
        var valueChanged = false


        if (currentFirstName != updatedFirstName) {
            params.firstName = updatedFirstName
            valueChanged = true
        }

        if (currentLastName != updatedLastName) {
            params.lastName = updatedLastName
            valueChanged = true
        }
        console.log(params);

        if (valueChanged == true) {
            $.ajaxSetup({
                headers: {
                    "X-CSRFToken": '{{ csrf_token }}'
                }
            })

            $.ajax({
                url: "{% url 'customer:update_customer_profile' %}",
                method: 'POST',
                data: params,

                success: function (response) {
                    console.log(response.status);
                }

            })
        }
    })

    $('#updateEmail').click(function () {
        var updatedEmail = $('#email').val()
        if (currentEmail != updatedEmail) {
            $.ajaxSetup({
                headers: {
                    "X-CSRFToken": '{{ csrf_token }}'
                }
            })

            $.ajax({
                url: "{% url 'customer:update_customer_profile' %}",
                method: 'POST',
                data: {
                    email: updatedEmail
                },

                success: function (response) {
                    console.log(response.status);
                }

            })
        }
    })

    $('#updateMobile').click(function () {
        var updatedMobile = $('#mobile').val()
        if (currentMobile != updatedMobile) {
            $.ajaxSetup({
                headers: {
                    "X-CSRFToken": '{{ csrf_token }}'
                }
            })

            $.ajax({
                url: "{% url 'customer:update_customer_profile' %}",
                method: 'POST',
                data: {
                    mobile: updatedMobile
                },

                success: function (response) {
                    console.log(response.status);
                }

            })
        }
    })

    $('#updateEmail').click(function () {
        var updatedEmail = $('#email').val()
        if (currentEmail != updatedEmail) {
            $.ajaxSetup({
                headers: {
                    "X-CSRFToken": '{{ csrf_token }}'
                }
            })

            $.ajax({
                url: "{% url 'customer:update_customer_profile' %}",
                method: 'POST',
                data: {
                    email: updatedEmail
                },

                success: function (response) {
                    console.log(response.status);
                }

            })
        }
    })


</script>
{% endblock %}